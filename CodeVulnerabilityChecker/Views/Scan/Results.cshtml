@model CodeVulnerabilityChecker.Models.ResultsViewModel

@{
    ViewBag.Title = "Results";
}

<h2>Vulnerability Results</h2>


@if (User.IsInRole("User") || User.IsInRole("Admin"))
{

    <div>
        <div class="text-code-input-area">
            <h3>@Html.DisplayFor(model => model.SnippetTitle)</h3>
            <p class="lead">by @Html.DisplayFor(model => model.SnippetOwner)</p>
            <p class="lead">Uploaded: @Html.DisplayFor(model => model.SnippetDate)</p>

            <h3>Source Code:</h3>
            @Html.TextAreaFor(model => model.SnippetContent, new { htmlAttributes = new { @class = "form-control", @runat = "server" } })
            <script type="text/javascript" src="~/Scripts/codemirror-2.37/lib/codemirror.js"></script>
            <link rel="stylesheet" href="../Scripts/codemirror-2.37/lib/codemirror.css">
            <script type="text/javascript" src="~/Scripts/codemirror-2.37/mode/clike/clike.js"></script>

            <script type="text/javascript">
            var options = {
                mode: "javascript",
                theme: "default",
                lineNumbers: true,
                smartIndent: true,
                viewportMargin: Infinity,
                readOnle: true
            };

            var myCodeMirror = CodeMirror.fromTextArea(SnippetContent, options);
            </script>
        </div>


        <div class="results-box">

            <h3>Vulnerability Count: <b id="vulCount">@Model.ResultsCount.ToString()</b></h3>

            <h3>
                Overall impact of your snippet:
                @if (Model.ResultsCount == 0)
                {
                    <b style="color: #0db600">@Html.DisplayFor(model => model.ResultsImpact)</b>
                }
                else if (Model.ResultsCount >= 1 && Model.ResultsCount < 3)
                {
                    <b style="color: #c9e800">@Html.DisplayFor(model => model.ResultsImpact)</b>
                }
                else if (Model.ResultsCount >= 3 && Model.ResultsCount < 5)
                {
                    <b style="color: #ff6a00">@Html.DisplayFor(model => model.ResultsImpact)</b>
                }
                else if (Model.ResultsCount >= 5)
                {
                    <b style="color: #e20000">@Html.DisplayFor(model => model.ResultsImpact)</b>
                }
                else
                {
                    <b>@Html.DisplayFor(model => model.ResultsImpact)</b>
                }
            </h3>

            <script type="text/javascript" src="~/Scripts/ChangeBackground.js"></script>

            <div class="result-summaries-box">
                @if (Model.ResultSummaries.Any())
                {
                    for (int i = 0; i < Model.ResultSummaries.Count; i++)
                    {
                        int num = i + 1;
                        <b>@num: </b>@Html.DisplayFor(model => model.ResultSummaries[i])
                        <br />
                        <br />
                    }
                }
                else
                {
                    <b>There were no vulnerabilities found</b>
                }
            </div>
        </div>
    </div>
}
else
{
    <h2>You must @Html.ActionLink("sign in", "Login", "Account") to use the code scanner</h2>
}

<br />
<p>
    @Html.ActionLink("Finish", "EndScan", null, new { @class = "btn btn-default" })
</p>